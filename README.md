# Kitty Enc - 文件加密工具

一个用 Rust 编写的简单的文件加密工具，支持密钥文件和纯密码两种加密模式。

## 快速开始

### 编译环境设置(有需要的话)
```powershell
$env:RUSTFLAGS="-C target-feature=+crt-static"
```

### 基本用法
```bash
kitty_enc [OPTIONS] [COMMAND]
```

## 命令(不建议使用子命令)

| 命令 | 描述 |
|------|------|
| `encrypt` | 加密模式 |
| `decrypt` | 解密模式 |
| `help` | 显示帮助信息 |

## 选项(推荐直接使用选项)

| 选项 | 参数 | 描述 |
|------|------|------|
| `-k, --key` | `<KEY_FILE>` | 密钥文件路径（可选）。如果指定，则使用该密钥文件；如果不指定，程序会自动查找或生成密钥文件 |
| `-s, --src` | `<DIR>` | 要加密的目录路径。加密时会优先在该目录中查找密钥文件 |
| `-d, --dec` | `<DIR>` | 要解密的目录路径。解密时会优先在该目录中查找密钥文件 |
| `-p, --passwd-only` | | 使用纯密码模式，不生成密钥文件 |
| `-f, --fix` | `<DIR>` | 要修复的目录路径。修复时会收集该目录下的所有文件进行比对 |
| `-h, --help` | | 显示帮助信息 |
| `-V, --version` | | 显示版本信息 |

## 使用示例

### 基本操作
```bash
# 无参数：在当前目录生成密钥并加密当前目录（默认使用密码短语）
kitty_enc

# 加密指定目录（优先在 DIR 中查找密钥，没有则生成，默认使用密码短语）
kitty_enc -s DIR

# 使用指定密钥加密指定目录（默认使用密码短语）
kitty_enc -k key.kitty_key -s DIR

# 显式加密指定目录（优先在 DIR 中查找密钥，没有则生成，默认使用密码短语）
kitty_enc encrypt -s DIR
```

### 解密操作
```bash
# 解密指定目录（在 DIR 中查找密钥文件，默认使用密码短语）
kitty_enc -d DIR

# 使用指定密钥解密指定目录（默认使用密码短语）
kitty_enc -k key.kitty_key -d DIR

# 显式解密指定目录（在 DIR 中查找密钥文件，默认使用密码短语）
kitty_enc decrypt -d DIR
```

### 纯密码模式
```bash
# 纯密码模式：使用密码加密当前目录（不生成密钥文件）
kitty_enc -p

# 纯密码模式：使用密码加密指定目录（不生成密钥文件）
kitty_enc -p -s DIR

# 纯密码模式：使用密码解密指定目录（不生成密钥文件）
kitty_enc -p -d DIR
```

## 注意事项

### 文件处理规则
- **跳过空文件**（大小为 0 的文件）
- **跳过隐藏文件**：以 `.` 开头的目录和文件（如 `.git`）
- **跳过忽略文件**：`.kitignore` 中规定的文件
- **跳过特殊文件**：
  - 自身可执行文件
  - 密钥文件（`*.kitty_key` 和 `-k` 指定的密钥）
  - 已加密文件（`*.kitty_enc`）

### 加密相关
- **加密后缀**：`.kitty_enc`
- **默认密钥文件**：`目录名-时间.kitty_key`（生成于源目录中）
- **密钥文件后缀**：可以修改为任何后缀使用，但不使用默认后缀的密钥无法自动识别

### 密钥查找逻辑
#### 加密时：
1. 如果指定了 `-k` 参数，则使用指定的密钥文件
2. 如果没有指定 `-k` 参数，则优先在源目录（`-s` 指定的目录）中查找现有的密钥文件
3. 如果找不到现有密钥文件，则创建新的密钥文件（生成在源目录中）

#### 解密时：
1. 如果指定了 `-k` 参数，则使用指定的密钥文件
2. 如果没有指定 `-k` 参数，则在解密目录（`-d` 指定的目录）中查找密钥文件

### 其他规则
- **密钥查找范围**：只搜索一层目录，不递归搜索子文件夹
- **文件清理**：加密后删除原始文件，解密后删除加密文件
- **密钥保护**：所有 `.kitty_key` 文件都不会被加密，无论是否是指定的密钥文件

### 获取帮助
```bash
# 显示完整帮助
kitty_enc --help

# 显示子命令帮助
kitty_enc encrypt --help
kitty_enc decrypt --help
```


